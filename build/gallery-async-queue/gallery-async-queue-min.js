YUI.add("gallery-async-queue",function(a){a.AsyncQueue=function(){this._init();this.add.apply(this,arguments);};var e=a.AsyncQueue,b="execute",h="shift",g="promote",f="remove",d="reset",i=a.Lang.isObject,c=a.Lang.isFunction;e.defaults=a.mix({autoContinue:true,iterations:1,timeout:10,until:function(){this.iterations|=0;return this.iterations<=0;}},a.config.queueDefaults||{});a.extend(e,a.EventTarget,{_running:false,_init:function(){a.EventTarget.call(this,{prefix:"queue",emitFacade:true});this._q=[];this._qReset=null;this._handles=[];this.run=a.bind(this.run,this);this.defaults={};this._initEvents();},_initEvents:function(){this.publish({"execute":{defaultFn:this._defExecFn,emitFacade:true},"shift":{defaultFn:this._defShiftFn,emitFacade:true},"add":{defaultFn:this._defAddFn,emitFacade:true},"promote":{defaultFn:this._defPromoteFn,emitFacade:true},"remove":{defaultFn:this._defRemoveFn,emitFacade:true},"reset":{defaultFn:this._defResetFn,emitFacade:true}});},config:function(j){this.defaults=a.merge(this.defaults,j);return this;},next:function(){var j;while(this._q.length){j=this._q[0]=this._prepare(this._q[0]);if(j&&j.until()){this.fire(h,{callback:j});j=null;}else{break;}}return j||null;},_defShiftFn:function(j){if(this.indexOf(j.callback)===0){this._q.shift();}},_prepare:function(l){if(c(l)&&l._prepared){return l;}var j=a.merge(e.defaults,{context:this,args:[],_prepared:true},this.defaults,(c(l)?{fn:l}:l)),k=a.bind(function(){if(!k._running){k.iterations--;}if(k.context==="callback"){k.context=k;}if(k.alwaysPause){this.pause();}if(c(k.fn)){return k.fn.apply(k.context||a,a.Array(k.args));}},this);return a.mix(k,j);},callbackBreak:function(j){if(this._q.length){if(!this._q[0]._running){this.pause();}this._q[0].until=function(){return true;};}return this.run();},reset:function(j){this.fire(d,{andRun:j});return this;},_defResetFn:function(j){if(this._qReset){this.stop();this._q=a.clone(this._qReset);}if(j.andRun){setTimeout(this.run,1);}},clearHandles:function(){var j=this;if(j._handles){a.each(this._handles,function(k){if(k){if(k.cancel){k.cancel();}else{if(k instanceof a.EventHandle){k.detach();}}}});}j._handles=[];return j;},run:function(){if(!this._qReset){this._qReset=a.clone(this._q);}this.clearHandles();return this._run(Array.prototype.slice.call(arguments));},_run:function(k){var l,j=true;if(this._q.length&&this._q[0]._running){this._running=true;if(k&&k.length){l=this.next();if(l){l.args=k;}}return this;}l=this.next();if(k&&k.length&&l){l.args=k;}for(;j&&l&&!this.isRunning();l=this.next()){j=(l.timeout<0)?this._execute(l,true):this._schedule(l);}if(!l){this.clearHandles();this.fire("complete");}return this;},_execute:function(l,k){l._running=true;this._running=this._running||true;l.iterations--;this.fire(b,{callback:l});var j=this._running&&l.autoContinue;l._running=false;if(i(this._running)&&k){}else{this._running=false;}return j;},_schedule:function(j){this._running=a.later(j.timeout,this,function(){if(this._execute(j)){this._run();}});return false;},isRunning:function(){return !!this._running;},_defExecFn:function(k){var j=k.callback();if(j&&j!==this){this._handles.push(j);}},add:function(){this.fire("add",{callbacks:a.Array(arguments,0,true)});return this;},_defAddFn:function(k){var l=this._q,j=[];a.Array.each(k.callbacks,function(m){if(i(m)){l.push(m);j.push(m);}});k.added=j;},addFront:function(){var j=this;j.add.apply(this,arguments);a.each(Array.prototype.slice.call(arguments).reverse(),function(k){j.promote(k);});return j;},pause:function(){if(i(this._running)){this._running.cancel();}this._running=false;return this;},stop:function(){this._q=[];this.clearHandles();return this.pause();},indexOf:function(m){var k=0,j=this._q.length,l;for(;k<j;++k){l=this._q[k];if(l===m||l.id===m){return k;}}return -1;},getCallback:function(k){var j=this.indexOf(k);return(j>-1)?this._q[j]:null;},promote:function(l){var k={callback:l},j;if(this.isRunning()){j=this.after(h,function(){this.fire(g,k);j.detach();},this);}else{this.fire(g,k);}return this;},_defPromoteFn:function(l){var j=this.indexOf(l.callback),k=(j>-1)?this._q.splice(j,1)[0]:null;l.promoted=k;if(k){this._q.unshift(k);}},remove:function(l){var k={callback:l},j;if(this.isRunning()){j=this.after(h,function(){this.fire(f,k);j.detach();},this);}else{this.fire(f,k);}return this;},_defRemoveFn:function(k){var j=this.indexOf(k.callback);k.removed=(j>-1)?this._q.splice(j,1)[0]:null;},size:function(){if(!this.isRunning()){this.next();}return this._q.length;}});},"@VERSION@",{requires:["event-custom"]});